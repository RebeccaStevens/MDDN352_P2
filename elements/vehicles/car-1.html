<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../entity-bone-model/entity-bone-model.html">
<link rel="import" href="../model-bone/model-bone.html">

<polymer-element name="car-1" extends="entity-bone-model">
  <template>
    <style>
    :host{
      position: relative;
    }
		:host(.show-bones) model-bone::shadow svg{
		  display: block;
		}
		#body{
      position: absolute;
    }
		#body > .content{
		  position: absolute;
      left: {{bodyOffsetX - 55}}px;
      top: {{bodyOffsetY - 300}}px;
		}
		polyfill-next-selector { content: ':host *' }
    ::content * {
      position: absolute;
    }
		polyfill-next-selector { content: '#fwheel > [front-wheel]' }
    #fwheel ::content > [front-wheel]{
      top: -31px;
      left: -27px;
    }
    polyfill-next-selector { content: '#rwheel > [rear-wheel]' }
    #rwheel ::content > [rear-wheel]{
      top: -29px;
      left: -27px;
    }
    </style>
    <model-bone id="root" length="0" angle="0">
	    <model-bone id="body" length="257" angle="0">
	      <div class="content">
	        <content select=":not([body]):not([front-wheel]):not([rear-wheel])"></content>
	        <content select="[body]"></content>
	      </div>
	      <model-bone id="rwheel" length="30" angle="0">
	        <content select="[rear-wheel]"></content>
	      </model-bone>
	    </model-bone>
	    <model-bone id="fwheel" length="30" angle="0">
	      <content select="[front-wheel]"></content>
      </model-bone>
	  </model-bone>
  </template>
  <script>
    Polymer({
    	bodyOffsetX: 0,
    	bodyOffsetY: 0,
      ready: function(){
    	  this.super();
      },
      animate: function(app){
    	  this.super([app.time_step, 0]);
    	  this.animateDrive(app, this.vel_x);
      },
      animateDrive: function(app, speed){
    	  this.animateFrontWheel(app, 2.5 * speed);
        this.animateRearWheel(app, 2.5 * speed);
        this.animateBody(app);
      },
      animateFrontWheel: function(app, speed){
    	  this.$.fwheel.angle += speed * app.time_step;
      },
      animateRearWheel: function(app, speed){
        this.$.rwheel.angle += speed * app.time_step;
      },
      animateBody: function(app){
    	  var amplitude = 3;
    	  var oscillation_factor = 0.020;
        this.bodyOffsetY = amplitude * Math.sin((app.time_stamp - app.start_time) * oscillation_factor);
      }
    });
  </script>
</polymer-element>